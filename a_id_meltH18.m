function a = a_id_meltH18(p_in,td)
pname_order = {'q4L,tc-ds633','sl1L,tc-ds633','wo1L,tc-ds633','fo2L,tc-ds633','fa2L,tc-ds633','jdL,tc-ds633','hmL,tc-ds633','ekL,tc-ds633','tiL,tc-ds633','kjL,tc-ds633','ctL,tc-ds633','h2o1L,tc-ds633'};
p = zeros(size(p_in,1),length(pname_order));
p_ind   = zeros(size(pname_order));
for ip = 1:length(pname_order)
    if sum(strcmp(td.p_name,pname_order(ip)))>0
        p_ind(ip) = 1;
    end
end

p(:,p_ind==1) = p_in;

z(:,1) = p(:,1);
z(:,2) = p(:,2);
z(:,3) = p(:,3);
z(:,4) = p(:,6);
z(:,5) = p(:,7);
z(:,6) = p(:,8);
z(:,7) = p(:,9);
z(:,8) = p(:,10);
z(:,9) = p(:,11);
z(:,10) = p(:,4)+p(:,5);
z(:,11) = 1-p(:,12);
fact = 4./(3*p(:,11)+4);
z(:,12) = fact.*4.*p(:,4);
z(:,13) = fact.*4.*p(:,5);
z(:,14) = fact.*(p(:,3)+p(:,11));
z(:,15) = fact.*(p(:,2)+p(:,11));
z(:,16) = z(:,12)+z(:,13)+z(:,14)+z(:,15);
z(:,17) = fact.*p(:,12);
z(:,18) = 1-z(:,17);
z(z<=0) = 1e-16;

a(:,1) = z(:,18).^2.*z(:,1)./z(:,11);
a(:,2) = (z(:,18).^2.*z(:,2).*z(:,15))./(z(:,11).*z(:,16));
a(:,3) = (z(:,18).^2.*z(:,3).*z(:,14))./(z(:,11).*z(:,16));
a(:,4) = (z(:,18).^2.*z(:,10).*z(:,12).^4)./(z(:,11).*z(:,16).^4);
a(:,5) = (z(:,18).^2.*z(:,10).*z(:,13).^4)./(z(:,11).*z(:,16).^4);
a(:,6) = z(:,18).^2.*z(:,4)./z(:,11);
a(:,7) = z(:,18).^2.*z(:,5)./z(:,11);
a(:,8) = z(:,18).^2.*z(:,6)./z(:,11);
a(:,9) = z(:,18).^2.*z(:,7)./z(:,11);
a(:,10) = z(:,18).^2.*z(:,8)./z(:,11);
a(:,11) = z(:,18).^2.*z(:,9)./z(:,11);
a(:,12) = z(:,17).^2;
a(a<=0) = 1e-16;

p = p(:,p_ind==1);
a = a(:,p_ind==1);